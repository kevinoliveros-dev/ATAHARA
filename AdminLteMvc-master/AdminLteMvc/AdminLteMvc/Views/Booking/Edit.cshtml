@model AdminLteMvc.Models.WEBSales.TransactionDetails
@{
    ViewBag.Title = "Edit Detail";
    Layout = "~/Views/Shared/_AdminLteLayout.cshtml";
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    <div class="box box-success">
        <div class="box-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="transactionno">Transaction No</label>
                            @Html.EditorFor(model => model.transactionNo, new { htmlAttributes = new { @Value = Model.transactionNo, @class = "form-control", id = "transactionno", @readonly = true } })
                        </div>
                        <div class="form-group">
                            <label for="plist">Price List</label> <br />
                            <select id="plist" class="form-control">
                                <option value="0">-- Select below --</option>
                                @{
                                    foreach (var item in ViewBag.PriceList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="origin">Origin</label> <br />
                            <select id="origin" class="form-control">
                                <option value="0">-- Select below --</option>
                                @{
                                    foreach (var item in ViewBag.OriginList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="destination">Destination</label> <br />
                            <select id="destination" class="form-control">
                                <option value="0">-- Select below --</option>
                                @{
                                    foreach (var item in ViewBag.DestinationList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="consignee">Consignee</label> <br />
                            <select id="consignee" class="form-control">
                                <option value="0">-- Select below --</option>
                                @{
                                    foreach (var item in ViewBag.ConsigneeList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="consigneeaddress">Consignee Address</label>
                            @Html.EditorFor(model => model.consigneeAdd, new { htmlAttributes = new { @class = "form-control", id = "consigneeaddress" } })
                        </div>
                        <div class="form-group">
                            <label for="servicetype">Service Type</label> <br />
                            <select id="servicetype" class="form-control">
                                <option value="0">-- Select below --</option>
                                @{
                                    foreach (var item in ViewBag.ServiceTypeList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="chargeto">Charge To</label> <br />
                            <select id="chargeto" class="form-control">
                                <option value="0">-- Select below --</option>
                                @{
                                    foreach (var item in ViewBag.ChargeToList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="myModal" role="dialog">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-body">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-10">
                                            <div class="form-group">
                                                <label for="cargotype">Cargo Type</label> <br />
                                                <select id="cargotype" class="form-control">
                                                    <option value="0">-- Select below --</option>
                                                    @{
                                                        foreach (var item in ViewBag.CargoTypeList)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="containerclass">Container Class</label> <br />
                                                <select id="containerclass" class="form-control">
                                                    <option value="0">-- Select below --</option>
                                                    @{
                                                        foreach (var item in ViewBag.ContainerClassList)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="conrequirements">ConVan Requirements</label> <br />
                                                <select id="conrequirements" class="form-control" multiple="multiple">
                                                    @{
                                                        foreach (var item in ViewBag.ConVanRequirementList)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="paymode">Payment Mode</label>
                                                @Html.EditorFor(model => model.payMode, new { htmlAttributes = new { @class = "form-control", id = "paymode" } })
                                            </div>
                                            <div class="form-group">
                                                <label for="cyepo">CY - Empty Pull Out</label> <br />
                                                <select id="cyepo" class="form-control">
                                                    <option value="0">-- Select below --</option>
                                                    @{
                                                        foreach (var item in ViewBag.EPOList)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="cysa">CY - Stuffing Activity</label> <br />
                                                <select id="cysa" class="form-control">
                                                    <option value="0">-- Select below --</option>
                                                    @{
                                                        foreach (var item in ViewBag.SAList)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="cyld">CY - Laden Delivery</label> <br />
                                                <select id="cyld" class="form-control">
                                                    <option value="0">-- Select below --</option>
                                                    @{
                                                        foreach (var item in ViewBag.LDList)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="rmrks">Remarks</label>
                                                @Html.TextAreaFor(m => m.remarks, new { @class = "form-control", id = "rmrks" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" data-dismiss="modal" id="modalSave">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box-footer">
            <input type="button" value="Save" style="width:80px" class="btn btn-primary" id="submit" />
            <input type="button" id="add" value="Details" style="width:80px" class="btn btn-info open-modal" data-toggle="modal" data-target="#myModal" />
            <input type="button" value="Cancel" style="width:80px" class="btn btn-default" onclick="location.href='@Url.Action("TrnDetails", "Booking", new { ID = @Model.transactionID})'" />
        </div>
    </div>
}

@section Scripts{
    @Scripts.Render("~/bundles/jqueryui")

<script type="text/javascript">
    $(document).ready(function () {
        $("#plist").chosen();
        $("#origin").chosen();
        $("#destination").chosen();
        $("#consignee").chosen();
        $("#servicetype").chosen();
        $("#chargeto").chosen();

        $("#containerclass").chosen({ width: '30%' });
        $("#cargotype").chosen({ width: '30%' });
        $("#conrequirements").chosen({ width: '30%' });
        $("#cyepo").chosen({ width: '30%' });
        $("#cysa").chosen({ width: '30%' });
        $("#cyld").chosen({ width: '30%' });

        document.getElementById("submit").disabled = true;
        $('#modalSave').on("click", function () {
            document.getElementById("submit").disabled = false;
        });

        var a = @Html.Raw(Json.Encode(Model.priceList));
        var b = @Html.Raw(Json.Encode(Model.origin));
        var c = @Html.Raw(Json.Encode(Model.destination));
        var d = @Html.Raw(Json.Encode(Model.consignee));
        var e = @Html.Raw(Json.Encode(Model.serviceType));
        var f = @Html.Raw(Json.Encode(Model.chargeTo));
        var g = @Html.Raw(Json.Encode(Model.conClass));
        var h = @Html.Raw(Json.Encode(Model.cargoType));
        var i = @Html.Raw(Json.Encode(Model.conRqrmnts));
        var j = @Html.Raw(Json.Encode(Model.cyEPO));
        var k = @Html.Raw(Json.Encode(Model.cySA));
        var l = @Html.Raw(Json.Encode(Model.cyLD));

        var arrRequire = i.split(',');

        console.log(arrRequire);

        $("#plist").val(a).trigger("chosen:updated");
        $("#origin").val(b).trigger("chosen:updated");
        $("#destination").val(c).trigger("chosen:updated");
        $("#consignee").val(d).trigger("chosen:updated");
        $("#servicetype").val(e).trigger("chosen:updated");
        $("#chargeto").val(f).trigger("chosen:updated");
        $("#containerclass").val(g).trigger("chosen:updated");
        $("#cargotype").val(h).trigger("chosen:updated");
        $("#conrequirements").val(arrRequire).trigger("chosen:updated");
        $("#cyepo").val(j).trigger("chosen:updated");
        $("#cysa").val(k).trigger("chosen:updated");
        $("#cyld").val(l).trigger("chosen:updated");

        $('#submit').click(function () {
            var isAllValid = true;
            if (isAllValid) {
                var trnsactionNo = @Html.Raw(Json.Encode(Model.transactionNo));
                var trnsacID = @Html.Raw(Json.Encode(Model.transactionID));
                var docuID = @Html.Raw(Json.Encode(Model.documentID));
                var transacDate = @Html.Raw(Json.Encode(Model.transactionDate));
                var issuedDate = @Html.Raw(Json.Encode(Model.trnInputtedDate));
                var tempreq = $('#conrequirements').val().join();
                var requirements = tempreq.toString();

                

                var dataDtls = {
                    tranID: @Model.tranID,
                    transactionID: @Model.transactionID,
                    transactionNo: trnsactionNo,
                    documentID: docuID,
                    dtlStatus: "Active",
                    priceList: $('#plist').val(),
                    origin: $('#origin').val(),
                    destination: $('#destination').val(),
                    consignee: $('#consignee').val(),
                    consigneeAdd: $('#consigneeaddress').val(),
                    cargoType: $('#cargotype').val(),
                    conClass: $('#containerclass').val(),
                    conRqrmnts: requirements,
                    payMode: $('#paymode').val(),
                    cyEPO: $('#cyepo').val(),
                    cySA: $('#cysa').val(),
                    cyLD: $('#cyld').val(),
                    remarks: $('#rmrks').val(),
                    chargeTo: $('#chargeto').val(),
                    serviceType: $('#servicetype').val(),
                    transactionDate: transacDate,
                    trnInputtedDate: issuedDate

                }
                console.log(dataDtls);


                $.ajax({
                    type: 'POST',
                    url: '../../../Booking/Update',
                    data: JSON.stringify(dataDtls),
                    contentType: 'application/json',
                    success: function (dataDtls) {
                        if (dataDtls.status) {
                            //alert('Successfully saved');
                            $.notify("Operation successfully posted.", "success");

                            var url = '@Url.Action("TrnDetails", "Booking", new { ID = @Model.transactionID})';
                            window.location.href = url;

                        }
                        else {
                            //alert('Error');
                            $.notify("Operation failed to post.", "error");
                        }
                        $('#submit').text('Save');
                    },
                    error: function (error) {
                        console.log(error);
                        $('#submit').text('Save');
                    }
                });
            }
        });
    });
</script>
}

<style>
    ul.chkbxs li {
        border: 1px transparent solid;
        display: inline-block;
        width: 15em;
        font-size: 12px;
    }

    .modal-dialog {
        width: 345px;
    }

    .modal-dialog {
        overflow-y: initial !important
    }

    .modal-body {
        height: 400px;
        overflow-y: auto;
    }

</style>